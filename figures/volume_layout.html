<!DOCTYPE html>
<html>
  <head>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.12.0/d3.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/flubber/0.4.2/flubber.min.js"></script>
      <script src="https://unpkg.com/d3-rect"></script>
      <script src="volgrammar-functions.js"></script>
  </head>
  <body>
    <div id="vis-volume-layout"></div>
    
    <script type="text/javascript">


        var forwardInt = [flubber.interpolateAll(cellsDisk, cellsMemory),
            flubber.interpolateAll(cellsMemory, cellsCyl),
            flubber.interpolateAll(cellsCyl, cellsDisk)];
        var reverseInt = [flubber.interpolateAll(cellsMemory, cellsDisk),
            flubber.interpolateAll(cellsCyl, cellsMemory),
            flubber.interpolateAll(cellsDisk, cellsCyl)];

        function setup(pathCollection) {
          svg.selectAll("path")
            .data(cellDataWithAMR)
            .enter()
            .append("path")
            .attr("stroke", "black")
            .attr("fill", d => cellColor(d.flatIndex))
            .attr("opacity", 0.75)
            .attr("d", (d, path_i) => pathCollection[path_i]);
        }

        function transitionCells(interpolator) {
            svg.selectAll("path")
                .data(cellDataWithAMR)
                .transition()
                .delay(d => (d.flatIndex + 1) * 10)
                .duration(2000)
                .attrTween("d", function(d, path_i) { return interpolator[path_i]});
        }

        var _transitions = [
            {
                transitionForward: () => setup(cellsDisk),
                index: 0
            },
            {
                transitionForward: () => transitionCells(forwardInt[0]),
                transitionBackward: () => transitionCells(reverseInt[0]),
                index: 1
            },
            {
                transitionForward: () => transitionCells(forwardInt[1]),
                transitionBackward: () => transitionCells(reverseInt[1]),
                index: 2
            }
        ];
    </script>
  </body>
</html>
